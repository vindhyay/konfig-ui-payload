<div class="table-widget" [ngStyle]="{ 'border-style': tableBorder ? 'solid' : 'none' }">
  <div
    [ngClass]="{
      'finlevit-table': true,
      'pagination-top': paginatorPosition === PaginatorPositionTypes.TOP,
      'pagination-bottom': paginatorPosition === PaginatorPositionTypes.BOTTOM
    }"
    [id]="tableId"
    sorter
    (sortChange)="onSortChange($event)"
  >
    <div class="f-table">
      <div
        class="f-thead"
        *ngIf="!hideHeader"
        [ngStyle]="{
          'min-width': getMinWidth(),
          'border-bottom-style': horizontalBorder ? 'solid' : 'none'
        }"
      >
        <div class="f-tr">
          <div
            class="f-th"
            [ngStyle]="{
              width: (col?.width || 100) + 'px',
              flex: (col?.width || 100) + ' 0 auto',
              'border-right-style': verticalBorder ? 'solid' : 'none'
            }"
            *ngFor="let col of columns"
            [sortEligible]="
              sort && !Object.keys(newRows).length && !Object.keys(editRows).length && !Object.keys(editCells).length
            "
            [ref]="col.columnId"
            [align]="col.alignment"
            sortHeader
          >
            <div class="f-resizable-header-content">
              <div
                [ngClass]="{
                  'f-column-header-name': true,
                  left: col.alignment === CellAlignTypes.LEFT,
                  right: col.alignment === CellAlignTypes.RIGHT,
                  center: col.alignment === CellAlignTypes.CENTER
                }"
              >
                {{ col?.name || col?.label }}
              </div>
            </div>
            <div class="f-resizer" (resizable)="onResize($event, col)"></div>
          </div>
          <div
            *ngIf="actions.editRow || actions.deleteRow"
            class="f-th"
            [ngStyle]="{
              width: (actions?.width || 100) + 'px',
              flex: (actions?.width || 100) + ' 0 auto'
            }"
          >
            <div class="f-resizable-header-content">
              <div
                [ngClass]="{
                  'f-column-header-name': true,
                  left: actions.alignment === CellAlignTypes.LEFT,
                  right: actions.alignment === CellAlignTypes.RIGHT,
                  center: actions.alignment === CellAlignTypes.CENTER
                }"
              >
                {{ actions.label }}
              </div>
            </div>
            <div class="f-resizer" (resizable)="onResize($event, actions)"></div>
          </div>
        </div>
      </div>
      <div
        class="f-tbody"
        [ngStyle]="{
          'min-width': getMinWidth()
        }"
        #tableBody
      >
        <ng-container
          *ngFor="
            let rowData of (tableFilters?.filtersEnabled ? filteredTableData : tableData)
              | paginationFilter
                : { page: this.currentPage - 1, limit: this.limitPerPage, isPaginationEnabled: isPaginationEnabled && !isServerSidePagination };
            let rowIndex = index
          "
        >
          <ng-container
            *ngTemplateOutlet="
              bodyRow;
              context: {
                $implicit: rowData,
                rowIndex: isPaginationEnabled && pagination ? pagination.start - 1 + rowIndex : rowIndex,
                columns: columns
              }
            "
          ></ng-container>
        </ng-container>
        <ng-template #bodyRow let-rowData let-rowIndex="rowIndex">
          <div class="f-tr-group" (click)="onRowClick.emit(rowData)">
            <div
              class="f-tr"
              [ngStyle]="{
                'min-height': '50px'
              }"
            >
              <div
                class="f-td"
                [ngStyle]="{
                  width: (col?.width || 100) + 'px',
                  flex: (col?.width || 100) + ' 0 auto'
                }"
                *ngFor="let col of columns"
                (dblclick)="onColEdit($event, col, rowIndex, rowData)"
              >
                <div
                  [ngClass]="{ 'cell-container': true }"
                  [ngStyle]="{
                    'border-right-style': verticalBorder ? 'solid' : 'none',
                    'border-bottom-style': horizontalBorder ? 'solid' : 'none'
                  }"
                >
                  <div
                    [ngClass]="{
                      'inner-cell-container': true,
                      left: col.alignment === CellAlignTypes.LEFT,
                      right: col.alignment === CellAlignTypes.RIGHT,
                      center: col.alignment === CellAlignTypes.CENTER
                    }"
                  >
                    <ng-container [ngSwitch]="col.colType">
                      <div class="p-pl-1" *ngSwitchCase="TextInput">
                        <ng-container
                          *ngIf="
                            !(
                              col?.validators?.editable &&
                              (editRows[rowIndex] ||
                                newRows[rowIndex] ||
                                (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                            )
                          "
                        >
                          {{ rowData[col.columnId] }}
                        </ng-container>
                        <finlevit-text
                          *ngIf="
                            col?.validators?.editable &&
                            (editRows[rowIndex] ||
                              newRows[rowIndex] ||
                              (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                          "
                          [(ngModel)]="modifyingData[rowIndex][col.columnId]"
                          (ngModelChange)="validateRow(rowIndex, modifyingData[rowIndex], col.columnId)"
                          [isSmall]="true"
                          [showErrorMsg]="false"
                          [error]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['error']
                              : false
                          "
                          [errorMsg]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['errorMsg']
                              : false
                          "
                        ></finlevit-text>
                      </div>
                      <div class="p-pl-1" *ngSwitchCase="TextArea">
                        <ng-container
                          *ngIf="
                            !(
                              col?.validators?.editable &&
                              (editRows[rowIndex] ||
                                newRows[rowIndex] ||
                                (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                            )
                          "
                        >
                          {{ rowData[col.columnId] }}
                        </ng-container>
                        <finlevit-lib-textarea
                          *ngIf="
                            col?.validators?.editable &&
                            (editRows[rowIndex] ||
                              newRows[rowIndex] ||
                              (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                          "
                          [(ngModel)]="modifyingData[rowIndex][col.columnId]"
                          (ngModelChange)="validateRow(rowIndex, modifyingData[rowIndex], col.columnId)"
                          [isSmall]="true"
                          [showErrorMsg]="false"
                          [error]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['error']
                              : false
                          "
                          [errorMsg]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['errorMsg']
                              : false
                          "
                        ></finlevit-lib-textarea>
                      </div>
                      <div class="p-pl-1" *ngSwitchCase="Number">
                        <ng-container
                          *ngIf="
                            !(
                              col?.validators?.editable &&
                              (editRows[rowIndex] ||
                                newRows[rowIndex] ||
                                (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                            )
                          "
                        >
                          {{ rowData[col.columnId] | number }}
                        </ng-container>
                        <finlevit-number
                          *ngIf="
                            col?.validators?.editable &&
                            (editRows[rowIndex] ||
                              newRows[rowIndex] ||
                              (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                          "
                          [(ngModel)]="modifyingData[rowIndex][col.columnId]"
                          (ngModelChange)="validateRow(rowIndex, modifyingData[rowIndex], col.columnId)"
                          [isSmall]="true"
                          [showErrorMsg]="false"
                          [error]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['error']
                              : false
                          "
                          [errorMsg]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['errorMsg']
                              : false
                          "
                        ></finlevit-number>
                      </div>
                      <div class="p-pl-1" *ngSwitchCase="DatePicker">
                        <ng-container
                          *ngIf="
                            !(
                              col?.validators?.editable &&
                              (editRows[rowIndex] ||
                                newRows[rowIndex] ||
                                (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                            )
                          "
                        >
                          {{ rowData[col.columnId] | date }}
                        </ng-container>
                        <finlevit-lib-datepicker
                          *ngIf="
                            col?.validators?.editable &&
                            (editRows[rowIndex] ||
                              newRows[rowIndex] ||
                              (editCells[rowIndex] && editCells[rowIndex][col.columnId]))
                          "
                          [(ngModel)]="modifyingData[rowIndex][col.columnId]"
                          (ngModelChange)="validateRow(rowIndex, modifyingData[rowIndex], col.columnId)"
                          [isSmall]="true"
                          [showErrorMsg]="false"
                          [minDate]="col?.validators?.minDate"
                          [maxDate]="col?.validators?.maxDate"
                          [error]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['error']
                              : false
                          "
                          [errorMsg]="
                            rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                              ? rowErrors[rowIndex][col.columnId]['errorMsg']
                              : false
                          "
                        ></finlevit-lib-datepicker>
                      </div>
                      <div *ngSwitchDefault>
                        {{ rowData[col.columnId] }}
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
              <div
                *ngIf="actions.editRow || actions.deleteRow"
                class="f-td"
                [ngStyle]="{
                  width: (actions?.width || 100) + 'px',
                  flex: (actions?.width || 100) + ' 0 auto'
                }"
              >
                <div
                  class="cell-container"
                  [ngStyle]="{
                    'border-bottom-style': horizontalBorder ? 'solid' : 'none'
                  }"
                >
                  <div
                    [ngClass]="{
                      'inner-cell-container': true,
                      'table-row-actions': true,
                      left: actions.alignment === CellAlignTypes.LEFT,
                      right: actions.alignment === CellAlignTypes.RIGHT,
                      center: actions.alignment === CellAlignTypes.CENTER
                    }"
                  >
                    <ng-container *ngIf="editRows[rowIndex]">
                      <div class="row-actions edit-action-mode">
                        <i class="pi pi-check save-icon" (click)="onRowSave(rowIndex, modifyingData[rowIndex])"></i>
                        <i
                          class="pi pi-times cancel-icon"
                          (click)="onRowEditCancel(rowIndex, modifyingData[rowIndex])"
                        ></i>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="!editRows[rowIndex] && newRows[rowIndex]">
                      <div class="row-actions new-action-mode">
                        <i
                          class="pi pi-check save-icon"
                          (click)="onRowSave(rowIndex, modifyingData[rowIndex], true)"
                        ></i>
                        <i
                          class="pi pi-trash delete-icon"
                          (click)="onDelete(rowIndex, modifyingData[rowIndex], true)"
                        ></i>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="!editRows[rowIndex] && !newRows[rowIndex]">
                      <div class="row-actions">
                        <span class="edit-action" *ngIf="actions?.editRow" (click)="onEdit(rowIndex, rowData)">
                          <i class="pi pi-pencil"></i>
                        </span>
                        <span
                          class="delete-action"
                          *ngIf="actions?.deleteRow"
                          (click)="onDelete(rowIndex, modifyingData[rowIndex])"
                        >
                          <i class="pi pi-trash delete-icon"></i>
                        </span>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
    <div class="-pagination">
      <div class="-left d-flex">
        <div class="table-results-counter" *ngIf="!Object.keys(editCells).length; else cellEditActions">
          <ng-container *ngIf="pagination?.totalRecords && isPaginationEnabled; else zeroRecordsResult">
            showing {{ pagination?.start }} - {{ pagination?.end }} of {{ pagination?.totalRecords }}
          </ng-container>
          <ng-template #zeroRecordsResult> showing {{ pagination?.totalRecords }} results </ng-template>
        </div>
        <ng-template #cellEditActions>
          <div class="p-ml-2 p-mr-2">
            <finlevit-button [isSmall]="true" (btnClick)="onColSave($event)" label="save"></finlevit-button>
          </div>
          <div class="p-ml-2 p-mr-2">
            <finlevit-button
              [isSmall]="true"
              bgColor="#dc3545"
              borderColor="#dc3545"
              (btnClick)="onColSaveCancel($event)"
              label="cancel"
            ></finlevit-button>
          </div>
        </ng-template>
      </div>
      <div [ngClass]="{ '-center': true, 'show-pagination': isPaginationEnabled }">
        <div class="-previous">
          <button class="footer-btn" [disabled]="pagination.isFirst" (click)="pagination.prev()"><i class="pi pi-angle-left"></i></button>
        </div>
        <span class="-pageInfo">
          <div class="-pageJump">
            <input
              pagination
              #pagination="pagination"
              [totalPages]="getTotalPages()"
              [pageNo]="currentPage"
              [limit]="limitPerPage"
              [totalRecords]="isServerSidePagination ? totalRecords : tableFilters?.filtersEnabled ? filteredTableData.length : tableData.length"
              (pageChange)="handlePageChange($event)"
              class="page-input"
              aria-label="Page number"
              type="number"
              value="1"
            />
          </div>
          of <span class="-totalPages">{{ pagination.totalPages }}</span></span
        >
        <div class="-next">
          <button class="footer-btn" [disabled]="pagination.isLast" (click)="pagination.next()"><i class="pi pi-angle-right"></i></button>
        </div>
      </div>
      <div
        class="table-actions"
        *ngIf="!Object.keys(newRows).length && !Object.keys(editRows).length && !Object.keys(editCells).length"
      >
        <app-custom-table-filters
          *ngIf="filter"
          #tableFilters
          [columns]="columns"
          (search)="handleSearch($event)"
        ></app-custom-table-filters>
        <button *ngIf="addRows" class="footer-btn" (click)="addRow()"><i class="pi pi-plus"></i></button>
      </div>
    </div>
  </div>
</div>

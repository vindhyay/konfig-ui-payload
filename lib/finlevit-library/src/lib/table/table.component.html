<p-table
  [lazy]="lazyLoad"
  (onLazyLoad)="onPage($event)"
  [columns]="columns"
  [value]="tableData"
  [styleClass]="styleClass"
  [paginator]="pagination && !!tableData.length"
  [rowsPerPageOptions]="[10, 20, 50]"
  [rows]="10"
  [totalRecords]="totalRecords || tableData.length"
  [paginatorDropdownAppendTo]="'body'"
  [resizableColumns]="true"
  [loading]="loading"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="{first} to {last} of {totalRecords}"
  [id]="tableId"
  [scrollable]="true"
  scrollHeight="100px"
>
  <ng-template pTemplate="header">
    <tr *ngIf="!hideHeader">
      <th
        [ngStyle]="{
          color: headerColor,
          backgroundColor: headerBgColor,
          border: !cellBorder ? 'none' : '',
          width: (column?.width || 100) + 'px',
          minWidth: (column?.width || 100) + 'px'
        }"
        [attr.colId]="column.columnId"
        [pSortableColumn]="sort ? column.columnId : ''"
        *ngFor="let column of columns"
      >
        {{ column.label }}
        <span class="resize-handle" (resizable)="onResize($event, column)"></span>
        <p-sortIcon *ngIf="sort" [field]="column.columnId"></p-sortIcon>
        <p-columnFilter
          *ngIf="filter"
          [type]="getColType(column.colType)"
          [field]="column.columnId"
          display="menu"
        ></p-columnFilter>
      </th>
      <ng-container *ngIf="editRow || deleteRow">
        <th
          [ngStyle]="{
            color: headerColor,
            backgroundColor: headerBgColor,
            width: (actionWidth || 100) + 'px',
            minWidth: (actionWidth || 100) + 'px',
            border: !cellBorder ? 'none' : '',
            textAlign: 'center'
          }"
          [pSortableColumn]="''"
        >
          {{ actionLabel }}
          <span class="resize-handle" (resizable)="onResize($event)"></span>
        </th>
      </ng-container>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
    <tr (click)="onRowClick.emit(rowData)">
      <td
        [ngStyle]="{
          width: (col?.width || 100) + 'px',
          minWidth: (col?.width || 100) + 'px',
          border: !cellBorder ? 'none' : ''
        }"
        *ngFor="let col of columns"
      >
        <ng-container [ngSwitch]="col.colType">
          <div class="p-pl-1" *ngSwitchCase="TextInput">
            <ng-container *ngIf="!(col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex]))">
              {{ rowData[col.columnId] }}
            </ng-container>
            <finlevit-text
              *ngIf="col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex])"
              (onBlur)="onColDataChange.emit({ column: col, data: rowData[col.columnId] })"
              [(ngModel)]="rowData[col.columnId]"
              (ngModelChange)="validateRow(rowIndex, rowData, col.columnId)"
              [isSmall]="true"
              [error]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['error']
                  : false
              "
              [errorMsg]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['errorMsg']
                  : false
              "
            ></finlevit-text>
          </div>
          <div class="p-pl-1" *ngSwitchCase="TextArea">
            <ng-container *ngIf="!(col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex]))">
              {{ rowData[col.columnId] }}
            </ng-container>
            <finlevit-lib-textarea
              *ngIf="col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex])"
              [(ngModel)]="rowData[col.columnId]"
              (ngModelChange)="validateRow(rowIndex, rowData, col.columnId)"
              [isSmall]="true"
              [error]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['error']
                  : false
              "
              [errorMsg]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['errorMsg']
                  : false
              "
            ></finlevit-lib-textarea>
          </div>
          <div class="p-pl-1" *ngSwitchCase="Number">
            <ng-container *ngIf="!(col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex]))">
              {{ rowData[col.columnId] | number }}
            </ng-container>
            <finlevit-number
              *ngIf="col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex])"
              (onBlur)="onColDataChange.emit({ column: col, data: rowData[col.columnId] })"
              [(ngModel)]="rowData[col.columnId]"
              (ngModelChange)="validateRow(rowIndex, rowData, col.columnId)"
              [isSmall]="true"
              [error]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['error']
                  : false
              "
              [errorMsg]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['errorMsg']
                  : false
              "
            ></finlevit-number>
          </div>
          <div class="p-pl-1" *ngSwitchCase="DatePicker">
            <ng-container *ngIf="!(col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex]))">
              {{ rowData[col.columnId] | date }}
            </ng-container>
            <finlevit-lib-datepicker
              *ngIf="col?.validators?.editable && (editRows[rowIndex] || newRows[rowIndex])"
              [(ngModel)]="rowData[col.columnId]"
              (ngModelChange)="validateRow(rowIndex, rowData, col.columnId)"
              [isSmall]="true"
              [minDate]="col?.validators?.minDate"
              [maxDate]="col?.validators?.maxDate"
              [error]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['error']
                  : false
              "
              [errorMsg]="
                rowErrors[rowIndex] && rowErrors[rowIndex][col.columnId]
                  ? rowErrors[rowIndex][col.columnId]['errorMsg']
                  : false
              "
            ></finlevit-lib-datepicker>
          </div>
          <div *ngSwitchDefault>
            {{ rowData[col.columnId] }}
          </div>
        </ng-container>
      </td>
      <td
        *ngIf="editRow || deleteRow"
        [ngStyle]="{ width: actionWidth + 'px', minWidth: actionWidth + 'px', border: !cellBorder ? 'none' : '' }"
        class="table-actions"
      >
        <ng-container *ngIf="editRows[rowIndex]">
          <div class="edit-action-mode">
            <i class="pi pi-check save-icon" (click)="onRowSave(rowIndex, rowData)"></i>
            <i class="pi pi-times cancel-icon" (click)="onRowEditCancel(rowIndex, rowData)"></i>
          </div>
        </ng-container>
        <ng-container *ngIf="!editRows[rowIndex] && newRows[rowIndex]">
          <div class="new-action-mode">
            <i class="pi pi-check save-icon" (click)="onRowSave(rowIndex, rowData, true)"></i>
            <i class="pi pi-trash delete-icon" (click)="onDelete(rowIndex, rowData, true)"></i>
          </div>
        </ng-container>
        <ng-container *ngIf="!editRows[rowIndex] && !newRows[rowIndex]">
          <div class="edit-action" *ngIf="editRow" (click)="onEdit(rowIndex, rowData)">
            <i class="pi pi-pencil"></i>
          </div>
          <div class="delete-action" *ngIf="deleteRow" (click)="onDelete(rowIndex, rowData)">
            <i class="pi pi-trash delete-icon"></i>
          </div>
        </ng-container>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="footer" class="table-footer">
    <p-button
      *ngIf="addRows && (!tableData.length || !pagination)"
      (click)="addRow()"
      type="button"
      icon="pi pi-plus"
      styleClass="p-button-text"
    ></p-button>
  </ng-template>
  <ng-template pTemplate="paginatorright">
    <p-button *ngIf="addRows" (click)="addRow()" type="button" icon="pi pi-plus" styleClass="p-button-text"></p-button>
  </ng-template>
  <ng-template pTemplate="paginatorleft"> </ng-template>
</p-table>
